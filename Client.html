<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Espace Client</title>
<style>
body { font-family: Arial; background:#f4f4f4; padding:20px; }
.box { background:white; padding:20px; border-radius:10px; max-width:600px; margin:auto; }
input, select, button { width:100%; padding:10px; margin-top:10px; }
button { background:#007bff; color:white; border:none; font-size:16px; cursor:pointer; }
.produit { border:1px solid #ddd; padding:10px; margin-top:10px; border-radius:8px; background:#fff; }
img { width:100%; border-radius:8px; margin-top:5px; }
</style>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
</head>
<body>

<div class="box">
  <h2>Commander un produit</h2>

  <input type="text" id="nomClient" placeholder="Ton nom" />

  <select id="produitSelect">
    <option value="">Choisir un produit</option>
  </select>

  <select id="villeSelect">
    <option value="">Choisir une ville</option>
    <option>Conakry</option>
    <option>Boké</option>
    <option>Fria</option>
    <option>Gaoual</option>
    <option>Telimélé</option>
    <option>Kindia</option>
    <option>Forécariah</option>
    <option>Labe</option>
    <option>Lélouma</option>
    <option>Dalaba</option>
    <option>Pita</option>
    <option>Koubia</option>
    <option>Kankan</option>
    <option>Kouroussa</option>
    <option>Siguiri</option>
    <option>Mandiana</option>
    <option>Kerouané</option>
    <option>Faranah</option>
    <option>Dabola</option>
    <option>Dinguiraye</option>
    <option>Macenta</option>
    <option>Nzérékoré</option>
    <option>Yomou</option>
    <option>Guéckédou</option>
    <option>Lola</option>
    <option>Beyla</option>
    <option>Kissidougou</option>
    <option>Forecariah</option>
    <option>Boffa</option>
    <option>Boké</option>
  </select>

  <select id="modePaiement">
    <option value="">Mode de paiement</option>
    <option>Orange Money +224625216110</option>
    <option>Mobile Money +224660452333</option>
  </select>

  <button onclick="passerCommande()">Passer la commande</button>
  <p id="message"></p>
</div>

<div class="box" id="commandesBox">
  <h3>Historique des commandes</h3>
</div>

<script>
  const firebaseConfig = {
    apiKey: "TA_CLE_API",
    authDomain: "TON_PROJET.firebaseapp.com",
    projectId: "TON_PROJET",
    storageBucket: "TON_PROJET.appspot.com",
    messagingSenderId: "XXXX",
    appId: "XXXX"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  function chargerProduits() {
    db.collection("produits").orderBy("date","desc").get().then(snapshot => {
      const select = document.getElementById("produitSelect");
      snapshot.forEach(doc => {
        const p = doc.data();
        const option = document.createElement("option");
        option.value = doc.id;
        option.textContent = `${p.nom} - ${p.prix} GNF (${p.vendeur})`;
        select.appendChild(option);
      });
    });
  }

  function passerCommande() {
    const produitId = document.getElementById("produitSelect").value;
    const ville = document.getElementById("villeSelect").value;
    const mode = document.getElementById("modePaiement").value;
    const client = document.getElementById("nomClient").value;

    if (!produitId || !ville || !mode || !client) {
      alert("Remplis tous les champs");
      return;
    }

    db.collection("commandes").add({
      produitId,
      ville,
      mode,
      client,
      date: new Date()
    }).then(() => {
      document.getElementById("message").innerText = "Commande passée ✅";
      afficherCommandes();
    });
  }

  function afficherCommandes() {
    const box = document.getElementById("commandesBox");
    box.innerHTML = "<h3>Historique des commandes</h3>";

    db.collection("commandes").orderBy("date","desc").get().then(snapshot => {
      snapshot.forEach(doc => {
        const c = doc.data();
        db.collection("produits").doc(c.produitId).get().then(prodDoc => {
          const p = prodDoc.exists ? prodDoc.data() : { nom: "Produit supprimé", vendeur: "" };
          const div = document.createElement("div");
          div.className = "produit";
          div.innerHTML = `
            Client: ${c.client} <br>
            Ville: ${c.ville} <br>
            Paiement: ${c.mode} <br>
            Produit: ${p.nom} <br>
            Vendeur: ${p.vendeur} <br>
            Date: ${c.date.toDate().toLocaleString()}
          `;
          box.appendChild(div);
        });
      });
    });
  }

  chargerProduits();
  afficherCommandes();
</script>

</body>
  </html>
