<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Site E-commerce</title>
<style>
body {font-family: Arial; padding:20px; background:#008000; color:#fff; font-size:18px;}
h2,h3,h4{font-size:22px}

nav {position:fixed;top:20px;left:20px;z-index:1000;}
nav button {font-size:22px;padding:12px 18px;}
#menu-list {display:none;background:#006400;padding:20px;font-size:22px;border-radius:8px;width:300px;}
#menu-list li{margin:15px 0;cursor:pointer;list-style:none;}
#menu-list .close-menu {cursor:pointer; text-align:right; font-weight:bold;}

section{margin-top:180px; display:none;}

.produit{background:#00b300; padding:10px; margin:10px; width:200px; display:inline-block; text-align:center}
.produit img{width:160px;height:160px;object-fit:cover}

button{padding:8px 12px; font-size:16px; background:#004d00; color:white; border:none; margin:4px 0; cursor:pointer}
input,select,textarea{width:100%; padding:8px; margin-bottom:10px; font-size:16px}

.paiement-box{background:#006400;padding:10px;border-radius:8px;margin:10px 0}
.compteur{background:#004d00;padding:4px 8px;border-radius:50%;margin-left:10px;}
</style>
</head>
<body>

<nav>
<button onclick="toggleMenu()">â˜° Menu</button>
<ul id="menu-list">
<li class="close-menu" onclick="toggleMenu()">âœ– Fermer</li>
<li onclick="showSection('produits-section')">Accueil</li>
<li onclick="showSection('vendeur-section')">Vendeur</li>
<li onclick="showSection('admin-section')">Admin</li>
</ul>
</nav>

<section id="produits-section" style="display:block">
<h2>Produits <span id="compteurPanier" class="compteur">0</span></h2>
<input type="text" id="rechercheProduit" placeholder="Rechercher un produit..." oninput="filtrerProduits()">
<div id="produits-container"></div>
</section>

<section id="panier-section">
<h2>Panier</h2>
<div id="panier-container"></div>

<h3>Informations Client</h3>
<form id="commandeFormPanier">
<input type="text" id="clientNom" placeholder="Nom utilisateur" required>
<input type="password" id="clientPass" placeholder="Mot de passe" required>
<input type="text" id="clientTel" placeholder="Votre numÃ©ro" required>

<h3>Informations Receveur</h3>
<input type="text" id="receveurNom" placeholder="Nom du receveur" required>
<input type="text" id="receveurTel" placeholder="TÃ©lÃ©phone du receveur" required>

<select id="villeLivraison" required></select>

<div class="paiement-box">
<h4>Moyens de paiement</h4>
<p>ðŸŸ  Orange Money : <b>+224 625 21 61 10</b></p>
<p>ðŸ”µ Mobile Money : <b>+224 660 45 23 33</b></p>
<p>AprÃ¨s paiement, envoyez la capture sur WhatsApp au 625216110.</p>
</div>
<button type="submit">Valider la commande</button>
</form>
</section>

<section id="admin-section">
<h2>Commandes reÃ§ues (Admin)</h2>
<div id="admin-commandes"></div>
</section>

<section id="vendeur-section">
<h3>Inscription / Connexion Vendeur</h3>
<form id="vendeurForm">
<input type="text" id="vendeur-username" placeholder="Nom utilisateur" required>
<input type="password" id="vendeur-pass" placeholder="Mot de passe" required>
<input type="text" id="vendeur-phone" placeholder="TÃ©lÃ©phone" required>
<select id="vendeur-ville" required></select>
<button type="submit">Valider</button>
</form>

<div id="ajoutProduit" style="display:none">
<h3>Ajouter Produit</h3>
<form id="formProduit">
<input type="text" id="nomProduit" placeholder="Nom produit" required>
<textarea id="descProduit" placeholder="Description" required></textarea>
<input type="number" id="prixProduit" placeholder="Prix" required>
<input type="file" id="imageProduit" required>
<button type="submit">Ajouter</button>
</form>
</div>
</section>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>

<script>
// Config Firebase
const firebaseConfig = {
  apiKey: "<YOUR_API_KEY>",
  authDomain: "<YOUR_AUTH_DOMAIN>",
  projectId: "<YOUR_PROJECT_ID>",
  storageBucket: "<YOUR_BUCKET>",
  messagingSenderId: "<YOUR_SENDER_ID>",
  appId: "<YOUR_APP_ID>"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Villes
const villes=["Conakry - Kaloum","Conakry - Dixinn","Conakry - Ratoma","Conakry - Matam","Conakry - Matoto","BokÃ©","Kindia","LabÃ©","Mamou","Kankan","Faranah","NzÃ©rÃ©korÃ©"];
function remplirVilles(){
document.getElementById("vendeur-ville").innerHTML=villes.map(v=>`<option>${v}</option>`).join("");
document.getElementById("villeLivraison").innerHTML=villes.map(v=>`<option>${v}</option>`).join("");
}
remplirVilles();

// Menu
function toggleMenu(){
const m=document.getElementById("menu-list");
m.style.display=m.style.display==="block"?"none":"block";
}
function showSection(id){
if(id==="admin-section"){
let user=prompt("Nom admin :");
let pass=prompt("Mot de passe admin :");
if(user!=="papasta" || pass!=="papasta3494"){alert("AccÃ¨s refusÃ©"); return;}
afficherCommandes();
}
document.querySelectorAll("section").forEach(s=>s.style.display="none");
document.getElementById(id).style.display="block";
}

// Stockage local
let produits=[], panier=[], commandes=[], vendeurConnecte=null;

// Compteur panier
function majCompteur(){
document.getElementById("compteurPanier").textContent = panier.length;
}

// Affichage produits
async function afficherProduits(){
const container=document.getElementById("produits-container");
container.innerHTML="";
const snapshot = await db.collection("produits").get();
produits = snapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
produits.forEach((p,i)=>{
container.innerHTML+=`<div class="produit">
<img src="${p.image}">
<h4>${p.nom}</h4>
<p>${p.prix} FG</p>
<button onclick="ajouterAuPanier(${i})">Ajouter au panier</button>
<button onclick="commanderDirect(${i})">Commander maintenant</button>
</div>`;
});
majCompteur();
}
afficherProduits();

// Panier
function afficherPanier(){
const c=document.getElementById("panier-container");
if(panier.length===0){c.innerHTML="<p>Panier vide</p>"; return;}
c.innerHTML=panier.map((p,i)=>`<p>${p.nom} - ${p.prix} FG <button onclick="supprimerPanier(${i})">Supprimer</button></p>`).join("");
majCompteur();
}
function ajouterAuPanier(i){panier.push(produits[i]); afficherPanier(); showSection("panier-section");}
function commanderDirect(i){panier=[produits[i]]; afficherPanier(); showSection("panier-section");}
function supprimerPanier(i){panier.splice(i,1); afficherPanier();}

// Recherche
function filtrerProduits(){
const val=document.getElementById("rechercheProduit").value.toLowerCase();
document.querySelectorAll(".produit").forEach(div=>{
const nom=div.querySelector("h4").textContent.toLowerCase();
div.style.display = nom.includes(val) ? "inline-block":"none";
});
}

// Vendeur
document.getElementById("vendeurForm").onsubmit = e=>{
e.preventDefault();
vendeurConnecte={
username:vendeurForm["vendeur-username"].value,
pass:vendeurForm["vendeur-pass"].value,
phone:vendeurForm["vendeur-phone"].value,
ville:vendeurForm["vendeur-ville"].value
};
document.getElementById("ajoutProduit").style.display="block";
alert("Vendeur enregistrÃ©");
};

// Ajouter produit
document.getElementById("formProduit").onsubmit = async e=>{
e.preventDefault();
const file = document.getElementById("imageProduit").files[0];
const formData = new FormData();
formData.append("file", file);
formData.append("upload_preset","ml_default");
try{
let res = await axios.post("https://api.cloudinary.com/v1_1/dmwrnpkhw/image/upload", formData);
let url = res.data.secure_url;
await db.collection("produits").add({
nom: document.getElementById("nomProduit").value,
description: document.getElementById("descProduit").value,
prix: Number(document.getElementById("prixProduit").value),
image: url,
vendeur: vendeurConnecte.username
});
alert("Produit ajoutÃ© !");
afficherProduits();
}catch(err){console.error(err); alert("Erreur lors de l'ajout");}
};

// Commande
document.getElementById("commandeFormPanier").onsubmit = async e=>{
e.preventDefault();
const client = {
nom: clientNom.value,
pass: clientPass.value,
tel: clientTel.value
};
const receveur = {
nom: receveurNom.value,
tel: receveurTel.value
};
const commande = {
client, receveur,
ville: villeLivraison.value,
produits: [...panier],
date: new Date()
};
try{
await db.collection("commandes").add(commande);
alert("Commande envoyÃ©e !");
panier=[];
afficherPanier();
}catch(err){console.error(err); alert("Erreur lors de l'envoi");}
};

// Admin
async function afficherCommandes(){
const c=document.getElementById("admin-commandes");
c.innerHTML="";
const snapshot = await db.collection("commandes").get();
const allCommandes = snapshot.docs.map(doc=>({id: doc.id,...doc.data()}));
allCommandes.forEach((cmd,i)=>{
cmd.produits.forEach(p=>{
c.innerHTML+=`<div style="background:#004d00;padding:10px;margin-bottom:10px">
<h4>Commande #${i+1}</h4>
<p>Client: ${cmd.client.nom} (${cmd.client.tel})</p>
<p>Receveur: ${cmd.receveur.nom} (${cmd.receveur.tel})</p>
<p>Ville: ${cmd.ville}</p>
<ul><li>${p.nom} - ${p.prix} FG (Vendeur: ${p.vendeur})</li></ul>
</div>`;
});
});
}
</script>
</body>
  </html>
