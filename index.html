<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Site E-commerce</title>
<style>
body {font-family: Arial; padding:20px; background:#4CAF50; color:#fff; font-size:18px;}
h2,h3,h4{font-size:22px}

nav {position:fixed;top:10px;left:10px;z-index:1000;width:300px;background:#388E3C;padding:15px;border-radius:8px;}
nav button {font-size:20px;padding:12px 18px;margin-bottom:10px;}
#menu-list {list-style:none;padding:0;display:block;}
#menu-list li{margin:15px 0;cursor:pointer;padding:8px;background:#2E7D32;border-radius:6px;}

section{margin-top:180px; display:none;}

.produit{background:#81C784; padding:10px; margin:10px; width:220px; display:inline-block; text-align:center;border-radius:8px;}
.produit img{width:180px;height:180px;object-fit:cover;border-radius:6px;}

button{padding:8px 12px; font-size:16px; background:#1B5E20; color:white; border:none; margin:4px 0;border-radius:6px;}
input,select,textarea{width:100%; padding:8px; margin-bottom:10px; font-size:16px;border-radius:6px;}
.paiement-box{background:#2E7D32;padding:10px;border-radius:8px;margin:10px 0;}
#panier-count{background:red;color:white;padding:2px 6px;border-radius:50%;margin-left:5px;}
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</head>
<body>

<nav>
<button onclick="toggleMenu()">‚ò∞ Menu</button>
<ul id="menu-list">
<li onclick="showSection('produits-section')">Accueil <span id="panier-count">0</span></li>
<li onclick="showSection('vendeur-section')">Vendeur</li>
<li onclick="showSection('panier-section')">Panier</li>
<li onclick="showSection('admin-section')">Admin</li>
<li><button onclick="closeMenu()">Fermer Menu</button></li>
</ul>
<input type="text" id="searchInput" placeholder="Rechercher un produit" oninput="rechercherProduit()">
</nav>

<section id="produits-section" style="display:block">
<h2>Produits</h2>
<div id="produits-container"></div>
</section>

<section id="panier-section">
<h2>Panier</h2>
<div id="panier-container"></div>

<h3>Informations Client</h3>
<form id="commandeFormPanier">
<input type="text" id="clientNom" placeholder="Votre nom" required>
<input type="text" id="clientTel" placeholder="Votre num√©ro" required>
<h3>Informations Receveur</h3>
<input type="text" id="receveurNom" placeholder="Nom du receveur" required>
<input type="text" id="receveurTel" placeholder="T√©l√©phone du receveur" required>
<select id="villeLivraison" required></select>

<div class="paiement-box">
<h4>Moyens de paiement</h4>
<p>üü† Orange Money : <b>+224 625 21 61 10</b></p>
<p>üîµ Mobile Money : <b>+224 660 45 23 33</b></p>
<p>Apr√®s paiement, envoyez la capture sur WhatsApp au 625216110</p>
</div>

<button type="submit">Valider la commande</button>
</form>
</section>

<section id="admin-section">
<h2>Commandes re√ßues (Admin)</h2>
<div id="admin-commandes"></div>
</section>

<section id="vendeur-section">
<h3>Inscription Vendeur</h3>
<form id="vendeurForm">
<input type="text" id="vendeur-username" placeholder="Nom utilisateur" required>
<input type="password" id="vendeur-pass" placeholder="Mot de passe" required>
<input type="text" id="vendeur-phone" placeholder="T√©l√©phone" required>
<select id="vendeur-ville" required></select>
<button type="submit">Valider</button>
</form>

<div id="ajoutProduit" style="display:none">
<h3>Ajouter Produit</h3>
<form id="formProduit">
<input type="text" id="nomProduit" placeholder="Nom produit" required>
<textarea id="descProduit" placeholder="Description" required></textarea>
<input type="number" id="prixProduit" placeholder="Prix" required>
<input type="file" id="imageProduit" required>
<button type="submit">Ajouter</button>
</form>
</div>
</section>

<script>
// ------------------------- VARIABLES -------------------------
const ADMIN_USER="papasta";
const ADMIN_PASS="papasta3494";

const villes = [
"Conakry - Kaloum","Conakry - Dixinn","Conakry - Ratoma","Conakry - Matam","Conakry - Matoto",
"Bok√©","Boffa","Fria","Gaoual","Kindia","Coyah","Dubr√©ka","Lab√©","L√©louma","Mali","Tougu√©","Mamou",
"Dalaba","Pita","Kankan","Kouroussa","K√©rouan√©","Siguiri","Mandiana","Kissidougou","Kerou","Faranah","Dabola","Nz√©r√©kor√©","Yomou","Macenta","Gu√©ck√©dou","Beyla","Lola"
];

let produits = [];
let panier = [];
let commandes = [];
let vendeurConnecte = null;

// ------------------------- FIREBASE -------------------------
const firebaseConfig = {
  apiKey: "<YOUR_API_KEY>",
  authDomain: "<YOUR_PROJECT>.firebaseapp.com",
  projectId: "<YOUR_PROJECT>",
  storageBucket: "<YOUR_PROJECT>.appspot.com",
  messagingSenderId: "<SENDER_ID>",
  appId: "<APP_ID>"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ------------------------- FONCTIONS MENU -------------------------
function toggleMenu(){
  const m = document.getElementById("menu-list");
  m.style.display = m.style.display==="block"?"none":"block";
}
function closeMenu(){
  document.getElementById("menu-list").style.display="none";
}
function showSection(id){
  if(id==="admin-section"){
    const user = prompt("Nom admin :");
    const pass = prompt("Mot de passe :");
    if(user!==ADMIN_USER || pass!==ADMIN_PASS){alert("Acc√®s refus√©");return;}
    afficherCommandes();
  }
  document.querySelectorAll("section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}

// ------------------------- REMPLIR VILLES -------------------------
function remplirVilles(){
  document.getElementById("vendeur-ville").innerHTML=villes.map(v=>`<option>${v}</option>`).join("");
  document.getElementById("villeLivraison").innerHTML=villes.map(v=>`<option>${v}</option>`).join("");
}
remplirVilles();

// ------------------------- AFFICHAGE PRODUITS -------------------------
function afficherProduits(){
  const c=document.getElementById("produits-container");
  const recherche=document.getElementById("searchInput").value.toLowerCase();
  c.innerHTML="";
  produits.forEach((p,i)=>{
    if(p.nom.toLowerCase().includes(recherche)){
      c.innerHTML+=`<div class="produit">
        <img src="${p.image}">
        <h4>${p.nom}</h4>
        <p>${p.prix} FG</p>
        <button onclick="commanderDirect(${i})">Commander</button>
      </div>`;
    }
  });
}
function rechercherProduit(){ afficherProduits(); }

// ------------------------- PANIER -------------------------
function afficherPanier(){
  const c=document.getElementById("panier-container");
  const compteur=document.getElementById("panier-count");
  compteur.innerText=panier.length;
  if(panier.length===0){c.innerHTML="<p>Panier vide</p>"; return;}
  let total=0;
  c.innerHTML="";
  panier.forEach((p,idx)=>{
    let livraison=p.prix*0.08;
    total += parseFloat(p.prix)+livraison;
    c.innerHTML+=`<p>${p.nom} - ${p.prix} FG + Livraison: ${livraison.toFixed(2)} FG 
    <button onclick="supprimerProduit(${idx})">Supprimer</button></p>`;
  });
  c.innerHTML+=`<h4>Total: ${total.toFixed(2)} FG</h4>`;
}
function ajouterAuPanier(i){
  panier.push(produits[i]);
  afficherPanier();
}
function commanderDirect(i){
  panier=[produits[i]];
  afficherPanier();
  showSection("panier-section");
}
function supprimerProduit(i){
  panier.splice(i,1);
  afficherPanier();
}

// ------------------------- VENDEUR -------------------------
vendeurForm.onsubmit=e=>{
  e.preventDefault();
  vendeurConnecte={
    username:vendeurForm["vendeur-username"].value,
    password:vendeurForm["vendeur-pass"].value,
    phone:vendeurForm["vendeur-phone"].value,
    ville:vendeurForm["vendeur-ville"].value
  };
  document.getElementById("ajoutProduit").style.display="block";
  alert("Vendeur enregistr√©");
};

// ------------------------- AJOUT PRODUIT CLOUDINARY + FIRESTORE -------------------------
formProduit.onsubmit=e=>{
  e.preventDefault();
  const file=imageProduit.files[0];
  const formData=new FormData();
  formData.append("file",file);
  formData.append("upload_preset","<YOUR_UPLOAD_PRESET>");

  fetch(`https://api.cloudinary.com/v1_1/dmwrnpkhw/image/upload`,{
    method:"POST", body:formData
  })
  .then(res=>res.json())
  .then(data=>{
    const produit={
      nom:nomProduit.value,
      description:descProduit.value,
      prix:prixProduit.value,
      image:data.secure_url,
      vendeur:vendeurConnecte.username
    };
    db.collection("produits").add(produit).then(()=>chargerProduitsFirebase());
  }).catch(err=>alert("Erreur upload: "+err));
};

function chargerProduitsFirebase(){
  db.collection("produits").get().then(snapshot=>{
    produits=[];
    snapshot.forEach(doc=>produits.push(doc.data()));
    afficherProduits();
  });
}

// ------------------------- COMMANDE -------------------------
commandeFormPanier.onsubmit=e=>{
  e.preventDefault();
  panier.forEach(p=>{
    const commande={
      clientNom:clientNom.value,
      clientTel:clientTel.value,
      receveurNom:receveurNom.value,
      receveurTel:receveurTel.value,
      ville:villeLivraison.value,
      produits:[p]
    };
    db.collection("commandes").add(commande);
  });
  alert("Commande envoy√©e !");
  panier=[];
  afficherPanier();
};

// ------------------------- ADMIN -------------------------
function afficherCommandes(){
  db.collection("commandes").get().then(snapshot=>{
    const c=document.getElementById("admin-commandes");
    c.innerHTML="";
    snapshot.forEach((doc,i)=>{
      const cmd=doc.data();
      c.innerHTML+=`<div style="background:#1B5E20;padding:10px;margin-bottom:10px">
        <h4>Commande #${i+1}</h4>
        <p>Client: ${cmd.clientNom} (${cmd.clientTel})</p>
        <p>Receveur: ${cmd.receveurNom} (${cmd.receveurTel})</p>
        <p>Ville: ${cmd.ville}</p>
        <ul>${cmd.produits.map(p=>`<li>${p.nom} - ${p.prix} FG (Vendeur: ${p.vendeur})</li>`).join("")}</ul>
      </div>`;
    });
  });
}

// ----- Initial load -----
chargerProduitsFirebase();
afficherPanier();
</script>
</body>
  </html>
