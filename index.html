<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Site E-commerce Complet</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
nav { position: fixed; top: 10px; left: 10px; z-index: 1000; }
#menu-list { list-style: none; padding: 0; margin: 0; background: #eee; border: 1px solid #ccc; display: none; }
#menu-list li a { display: block; padding: 5px 10px; text-decoration: none; color: #333; }
#produits-container, #panier-container { margin-top: 100px; }
.produit { border: 1px solid #ccc; padding: 10px; margin: 10px; display: inline-block; width: 180px; text-align: center; }
.produit img { width: 150px; height: 150px; object-fit: cover; }
</style>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>

<!-- MENU -->
<nav>
  <button id="menu-btn">Menu ☰</button>
  <ul id="menu-list">
    <li><a href="#produits-container">Accueil</a></li>
    <li><a href="#vendeur-section">Ajouter Produit (Vendeur)</a></li>
    <li><a href="#client-section">Inscription / Commande Client</a></li>
    <li><a href="#admin-section">Admin</a></li>
    <li><a href="#guide-section">Guide IA</a></li>
    <li><a href="#panier-container">Panier</a></li>
    <li><a href="#">Ajouter sur téléphone : Menu navigateur → “Ajouter à l’écran d’accueil”</a></li>
  </ul>
</nav>

<!-- PRODUITS -->
<h2>Produits disponibles</h2>
<div id="produits-container"></div>

<!-- PANIER -->
<h2>Panier</h2>
<div id="panier-container"></div>

<!-- CLIENT -->
<h2 id="client-section">Passer une commande</h2>
<form id="commandeForm">
  <input type="text" id="nom" placeholder="Nom complet" required><br><br>
  <input type="text" id="telephone" placeholder="Téléphone" required><br><br>
  <input type="text" id="ville" placeholder="Ville / Préfecture" required><br><br>
  <label for="payment">Moyen de paiement :</label>
  <select id="payment" required>
    <option value="orange">Orange Money - +224 625 216 110</option>
    <option value="mtn">MTN Mobile Money - +224 660 452 333</option>
    <option value="paycard">Paycard - 490 245 747</option>
  </select><br><br>
  <button type="submit">Passer la commande</button>
</form>

<!-- VENDEUR -->
<h2 id="vendeur-section">Ajouter un produit (Vendeur)</h2>
<form id="formProduit">
  <input type="text" id="nomProduit" placeholder="Nom produit" required><br><br>
  <textarea id="descProduit" placeholder="Description" required></textarea><br><br>
  <input type="number" id="prixProduit" placeholder="Prix" required><br><br>
  <input type="file" id="imageProduit" accept="image/*" required><br><br>
  <button type="submit">Ajouter Produit</button>
</form>

<!-- ADMIN -->
<h2 id="admin-section">Admin - Commandes</h2>
<div id="admin-container"></div>

<!-- GUIDE IA -->
<h2 id="guide-section">Guide IA</h2>
<p>Instructions pour le client :</p>
<ul>
  <li>Ajouter le site sur le téléphone : Menu navigateur → “Ajouter à l’écran d’accueil”</li>
  <li>Pour commander, ajoutez un produit au panier, puis remplissez le formulaire client</li>
  <li>Pour les moyens de paiement, utilisez les numéros indiqués</li>
</ul>

<script>
// FIREBASE CONFIG
const firebaseConfig = {
  apiKey: "TA_CLE_API",
  authDomain: "TON_PROJET.firebaseapp.com",
  projectId: "TON_PROJET",
  storageBucket: "TON_PROJET.appspot.com",
  messagingSenderId: "XXXXXXX",
  appId: "1:XXXXXXX:web:XXXXXX"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// MENU DÉROULANT
document.getElementById("menu-btn").addEventListener("click", () => {
  const menu = document.getElementById("menu-list");
  menu.style.display = (menu.style.display === "none") ? "block" : "none";
});

// PANIER
let panier = JSON.parse(localStorage.getItem("panier")) || [];
function ajouterAuPanier(nom, prix) {
  panier.push({nom, prix, quantite: 1});
  localStorage.setItem("panier", JSON.stringify(panier));
  afficherPanier();
}
function afficherPanier() {
  const container = document.getElementById("panier-container");
  container.innerHTML = "";
  panier.forEach(item => {
    container.innerHTML += `<p>${item.nom} - ${item.prix} FG x ${item.quantite}</p>`;
  });
}
afficherPanier();

// FORMULAIRE CLIENT
document.getElementById("commandeForm").addEventListener("submit", function(e){
  e.preventDefault();
  const nom = document.getElementById("nom").value;
  const telephone = document.getElementById("telephone").value;
  const ville = document.getElementById("ville").value;
  const paiement = document.getElementById("payment").value;

  let total = panier.reduce((acc, p) => acc + p.prix*p.quantite, 0);
  let pourcentageAdmin = 7;
  let montantAdmin = total * (pourcentageAdmin / 100);
  let montantVendeur = total - montantAdmin;

  db.collection("commandes").add({
    clientNom: nom,
    telephone: telephone,
    ville: ville,
    paiement: paiement,
    produits: panier,
    pourcentageAdmin: pourcentageAdmin,
    montantAdmin: montantAdmin,
    montantVendeur: montantVendeur,
    date: new Date()
  }).then(() => {
    alert("Commande enregistrée !");
    panier = [];
    localStorage.setItem("panier", JSON.stringify(panier));
    afficherPanier();
  }).catch(err => console.error(err));
});

// VENDEUR - Ajouter produit
document.getElementById("formProduit").addEventListener("submit", e => {
  e.preventDefault();
  const nom = document.getElementById("nomProduit").value;
  const desc = document.getElementById("descProduit").value;
  const prix = parseFloat(document.getElementById("prixProduit").value);
  const file = document.getElementById("imageProduit").files[0];

  // UPLOAD CLOUDINARY
  const urlCloudinary = "https://api.cloudinary.com/v1_1/TON_CLOUD_NAME/image/upload";
  const formData = new FormData();
  formData.append("file", file);
  formData.append("upload_preset", "TON_UPLOAD_PRESET");

  fetch(urlCloudinary, { method: "POST", body: formData })
    .then(res => res.json())
    .then(data => {
      db.collection("produits").add({
        nom: nom,
        description: desc,
        prix: prix,
        image: data.secure_url
      }).then(() => alert("Produit ajouté !"));
    }).catch(err => console.error(err));
});

// AFFICHAGE PRODUITS
function afficherProduits(produits) {
  const container = document.getElementById("produits-container");
  container.innerHTML = "";
  produits.forEach(prod => {
    const div = document.createElement("div");
    div.classList.add("produit");
    div.innerHTML = `
      <img src="${prod.image}" alt="${prod.nom}">
      <h3>${prod.nom}</h3>
      <p>${prod.description}</p>
      <p>Prix: ${prod.prix} FG</p>
      <button onclick="ajouterAuPanier('${prod.nom}', ${prod.prix})">Ajouter au panier</button>
    `;
    container.appendChild(div);
  });
}

// CHARGEMENT PRODUITS FIRESTORE
db.collection("produits").onSnapshot(snapshot => {
  let produits = [];
  snapshot.forEach(doc => produits.push(doc.data()));
  afficherProduits(produits);
});

// ADMIN - Voir commandes
db.collection("commandes").onSnapshot(snapshot => {
  const container = document.getElementById("admin-container");
  container.innerHTML = "";
  snapshot.forEach(doc => {
    const cmd = doc.data();
    container.innerHTML += `<p>
      Client: ${cmd.clientNom} | Ville: ${cmd.ville} | Paiement: ${cmd.paiement} | Total: ${cmd.montantVendeur+cmd.montantAdmin} FG | Commission 7%: ${cmd.montantAdmin} FG
    </p>`;
  });
});
</script>

</body>
  </html>
